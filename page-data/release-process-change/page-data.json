{"componentChunkName":"component---src-templates-blog-post-js","path":"/release-process-change/","webpackCompilationHash":"22e9ce3234fab3930d0d","result":{"data":{"markdownRemark":{"id":"5f65dcc8-4dfc-53db-96df-ed24faf67972","excerpt":"We at BookMyShow are changing how our release process works currently, by migrating from APKs to Android App Bundles. \nWhile we were changing how our production…","html":"<p>We at <a href=\"https://bookmyshow.com\">BookMyShow</a> are changing how our release process works currently, by migrating from APKs to Android App Bundles. <br/>\nWhile we were changing how our production releases and distribution works, we also decided to simplify how we share builds internally with our QA Team and other developers.\n<br/> <br/>\nPS: If you haven't heard of Android App Bundles, here's a good resource to read about it — <br/>\n<a href=\"https://medium.com/google-developer-experts/exploring-the-android-app-bundle-ca16846fa3d7\">https://medium.com/google-developer-experts/exploring-the-android-app-bundle-ca16846fa3d7</a>\n<br/> <br/></p>\n<h3>Old process walk-through:</h3>\n<p>Before we changed the process, this is how we distributed builds —\nInitially, we ran a script to generate APKs locally — this created 5 different APKs w.r.t. various CPU architectures. <br/></p>\n<p>This was followed by uploading all the APKs to a newly created Google Drive folder whose link was then shared with QA Team over Slack. <br/></p>\n<p>The QA Team would then download the required APK — based on the device architecture — and then proceed to install before starting the testing process.</p>\n<blockquote>\n<p>Too manual &#x26; tedious, I know!</p>\n</blockquote>\n<h3>Why you should use Bundles?</h3>\n<p>Android App Bundles is a new format that contains all the app codes and resources dumped into it. It’s uploaded to Google Play and the Play Store generates different APKs for different devices based on device specific features. <br/></p>\n<p>This means — <strong>smaller on-device APK size</strong> — because only resources and code that the device needs are shipped, hence can impact retention due to smaller on-device footprint. <br/></p>\n<p>One of the main selling points was — <strong>Dynamic Delivery</strong> — downloading part of the app only when user wants to access (lazy downloading). This can be useful for some modules which are important to the application, but used rarely. <br/></p>\n<p>Another benefit is the fact that it’s easier to share — just share a link and the needed APK can be installed. <br/></p>\n<h4>How is this secure though?</h4>\n<p>Google’s Internal App Sharing console gives the owner access to create list of Authorized Uploaders and Testers. Only the whitelisted email IDs can install the app on their device.\n<br/> <br/> <br/></p>\n<h3>What changes in the new process and how could you automate it too?</h3>\n<blockquote>\n<p>One script to rule ’em all!</p>\n</blockquote>\n<p>Once a developer is done coding a feature, the developer will initiate a build on the Build Machine (a dedicated server machine which does a fresh pull, compiles the code, and creates a build with the same specifications for everyone) along with passing in some parameters. <br/></p>\n<ol>\n<li>Generates an <strong>.aab</strong> file depending on the environment (QA or Production).</li>\n<li>Uses some parameters from the <strong>Service Account JSON</strong> to generate an <strong>Access Token</strong> from the Auth Token.</li>\n<li>This Access Token is used to generate a <strong>JWT</strong> (JSON Web Token) which is passed to the API which uploads it to <strong>Internal App Sharing</strong>.</li>\n<li>The API hit returns a link, which is posted in a specific Slack channel using an <strong>Incoming Webhook</strong>.</li>\n<li>QA Team can install the app directly from the Play Store link (Internal Sharing Console).\n<br/><br/><br/></li>\n</ol>\n<h4>Here’s the script that rules ’em all</h4>\n<figure>\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.55102040816327%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABlElEQVQ4y62T6YrCQBCE8/7vJYogosYfKvGM930LHrV8LS2zbNxl2R1oJplkaqq6aqLZbKb5fK7pdKrj8SjG4/H4scL/whHFcaxqtartdqv/GFG/31eSJBoMBup2u1osFoI1Bev1em2Hsb5cLnW/363esY4AGQ6H6vV6arfbmkwmGo/H1gYANpuNVquVAbN2OBx0uVwy2QEasXk0GhkQxWaYwep8Pltfmb1Op5OBss7s79fr9ckQFnzkA8XpbGT2jSEg66xRu93udejtdnsC0rtOp2MsG42Gyabo7W+HSa7VaioWiyoUCsrlcsrn8/aO+/SP3mEIz6jhGVOy4mUM+TFNUzMGZ9kAa9bDkwFBFhXm8EtskIlk3CY+yAUcYzCJVuz3+0x5mTkk1PV6Xa1WS81m81WAcxCuY1YWUCZDDzISmekTs2fPe8ca0fjuGhpguVw2A2BUKpXMkEqlYlIBQT7GwTpk+k6+xQYwin76jYEh4faZvGGI5y/M6yeGMHBQwMI7zDt5dMkeaA54C+hX5i8jlPwBrbjM/9X0My0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"A snippet of the bash script.\" title=\"A snippet of the bash script.\" src=\"/static/44824b429cfed94b3c4705711cbd7030/34e8a/bash_script.png\" srcset=\"/static/44824b429cfed94b3c4705711cbd7030/d4214/bash_script.png 150w,\n/static/44824b429cfed94b3c4705711cbd7030/135ae/bash_script.png 300w,\n/static/44824b429cfed94b3c4705711cbd7030/34e8a/bash_script.png 600w,\n/static/44824b429cfed94b3c4705711cbd7030/fea0e/bash_script.png 900w,\n/static/44824b429cfed94b3c4705711cbd7030/6ff5e/bash_script.png 1200w,\n/static/44824b429cfed94b3c4705711cbd7030/a4662/bash_script.png 1470w\" sizes=\"(max-width: 600px) 100vw, 600px\" loading=\"lazy\">\n    </span>\n    <figcaption>A snippet of the <a href=\"https://gist.github.com/jainakshansh/4c99fd133d9209fa0a46a10ff6b353f1\">bash script</a>.</figcaption>\n</figure>\n<br>\n<h3>Requirements for Automating App Bundles</h3>\n<h4>Setup Terminal</h4>\n<p>Install a JSON parser for terminal or shell commands — <br/>\n<code>brew install jq</code></p>\n<h4>Service Account</h4>\n<p>Create a <strong>Service Account</strong> — through which you can streamline the upload without exposing credentials for the main account. Also, this account should have publishing rights — which can be limited to test publishing too. You will need to download the <strong>Service Account JSON</strong> and add it to your project.</p>\n<h4>Google Play Console</h4>\n<p>Only if you’re the owner of the account — In the Google Play Console, <strong>enable the API access</strong> for the <strong>Google Play Developer API</strong>. <br/> </p>\n<p>Then proceed to Automatic App Signing — upload your keystore(.jks) or a certificate(.pem) file to the Google Play Console so you won’t have to sign artifacts manually. <br/> </p>\n<p>Here, create a list of Authorized Uploaders and Testers. You can have different lists for both. Make sure you tick the required lists to enable authorization. <br/> </p>\n<h4>Google Play Store</h4>\n<p>You will need to switch on Internal App Sharing to install via the link. <br/> <br/>\nGo to Google Play Store → Settings → About → Tap on Google Play Version 7 times. <strong>Toggle on Internal App Sharing</strong>. <br/> <br/></p>\n<h4>Sharing</h4>\n<p>Create an incoming webhook and configure it to post to a certain Slack channel. This will enable you to share the URL automatically once the AAB is uploaded and you get the link. <br/></p>\n<h5>PS: You can change which channel you want to post the link in by overriding the channel variable in the POST request data which is consumed by the incoming webhook. For more details on how to post data through incoming webhooks, please follow the <a href=\"https://api.slack.com/messaging/webhooks\">official Slack API documentation.</a></h5>\n<p><br/> <br/> <br/></p>\n<h3>Advantages:</h3>\n<p>The change in release process meant that we benefited on a few fronts — <br/></p>\n<p>Firstly, our app <strong>build time</strong> (for a completely new build, without any caching) <strong>went down by ~70%</strong> — this is because with Android App Bundles, it just dumps every resource into the bundle, rather than segregating like for APKs. <br/></p>\n<p>Furthermore, we saved <strong>~11% on our app size</strong> on device — because of splits based on 3 major fronts — Device Resolution, Device Language, and Device Architecture. <br/></p>\n<p>Finally, we saved a lot of <strong>manual effort by completely automating the process</strong> — once the build is completed, it’s link is uploaded and shared on a specific Slack channel automatically. No manual intervention is needed.\n<br/> <br/> <br/></p>\n<h3>Wrap Up:</h3>\n<p>One thing I learned is, if you want to automate something, do it end to end. Partial automation can be helpful but put in the effort to go the extra mile and you'll see amazing results.\n<br/></p>\n<p><strong>Tooltip</strong>: You can modify above script to upload the generated Android App Bundle (.aab) to Google Play Store for distributing to users.\n<br/> <br/></p>\n<h4>Below are some of the links that helped me to achieve the release automation — <br/></h4>\n<ol>\n<li><a href=\"https://support.google.com/googleplay/android-developer/answer/9303479?hl=en\">Play Console Help</a><br/></li>\n<li><a href=\"https://developers.google.com/identity/protocols/OAuth2ServiceAccount\">OAuth 2.0 for Service Accounts</a><br/></li>\n<li><a href=\"https://developers.google.com/android-publisher/api-ref/internalappsharingartifacts\">Google Play Developer API - Internal App Sharing Artifacts</a><br/></li>\n<li><a href=\"https://medium.com/swlh/google-playstore-and-automated-deployment-with-aab-a35eddabf128?\">Alistair Sykes blog on Medium</a><br/></li>\n</ol>\n<blockquote>\n<p>If you enjoyed this article, please share with a friend to help it reach someone who needs to read it. Thank you!</p>\n</blockquote>","frontmatter":{"title":"Automating the Android App Distribution process at BookMyShow","date":"December 23, 2019","description":"Using Android App Bundles, one bash script, and Google's Internal App Sharing API.","duration":"5 min read","caption":"Migrating from APKs to Android App Bundles! Source - https://developer.android.com/platform/technology/app-bundle","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjklEQVQI16WMMQ7CMBAE80I+QsszqPgHJS+goAJFieRgO2f7HAcQwZAiXbCP4wmIkXa0zW5BRO88T/NIlOlHCs5e7JabhX/J4f6USusWRCMdeu5d6FswAJZLVQswzlo8nsrmrHLO33GFh/V2NUwhxhGMQfTWsTr2I0aloazqEPrL9cZHiJ3ie2NTSgX9wQfK+N7KJhiTuAAAAABJRU5ErkJggg==","aspectRatio":5.086956521739131,"src":"/static/e7857cb91bdba8aa88b8da91ccc5c786/728bb/index.png","srcSet":"/static/e7857cb91bdba8aa88b8da91ccc5c786/f0363/index.png 270w,\n/static/e7857cb91bdba8aa88b8da91ccc5c786/5364a/index.png 540w,\n/static/e7857cb91bdba8aa88b8da91ccc5c786/728bb/index.png 1080w,\n/static/e7857cb91bdba8aa88b8da91ccc5c786/fa0ed/index.png 1170w","sizes":"(max-width: 1080px) 100vw, 1080px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/release-process-change/","previous":{"fields":{"slug":"/initial-learnings-bms/"},"frontmatter":{"title":"10 Things I Learned In 4 Months At BookMyShow"}},"next":null}}}